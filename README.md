(54)发明名称
一种使用大语言模型推理的多回合对话情
感四重提取方法
(57)摘要
本发明公开了一种使用大语言模型推理的
多回合对话情感四重提取方法，涉及情感四重提
取技术领域，包括，采集多回合对话数据及上下
文信息，并对数据进行预处理；通过动态词元修
剪模型对上下文信息进行词元修剪；建立知识蒸
馏模型，根据推理结果结合多回合对话数据构建
多层次教师模型；通过多层级教师模型指导学生
模型从多层次的对话知识中学习到对话中的细
节信息；基于LazyLLM和知识蒸馏模型处理后的
对话，构建出对话图；使用二维结构熵最小化算
法将对话划分为最小的子对话并合并，实现最优
划分，形成子对话集；构建二维表格标注实体关
系，提取话语中的实体，基于子对话集匹配实体，
形成情感四元组；通过预测实体之间的关系，并
最终匹配情感四元组。

技术领域
[0001] 本发明涉及情感四重提取技术领域，特别是一种使用大语言模型推理的多回合对
话情感四重提取方法。
背景技术
[0002] 随着自然语言处理技术的快速发展，多回合对话系统在智能客服、虚拟助手和社
交机器人等领域得到了广泛应用。在这些应用中，情感分析作为理解用户情感状态的重要
手段，对于提升用户体验和系统响应质量至关重要。情感四重提取则是情感分析中的一种
高级任务，它不仅需要识别对话中的情感极性（如积极、消极、中性），还需提取情感的目标、
方面及其意见。
[0003] 近年来，基于深度学习的大型语言模型（如BERT、GPT系列）在情感分析任务中展现
出了优越的性能。然而，这些模型在处理长文本或多回合对话时，仍面临计算资源消耗大、
推理速度慢等问题，限制了其在对话系统中的应用。
发明内容
[0004] 鉴于上述现有存在的问题，提出了本发明。
[0005] 因此，本发明提供了一种使用大语言模型推理的多回合对话情感四重提取方法解
决提升情感提取的准确性，降低计算成本的问题。
[0006] 为解决上述技术问题，本发明提供如下技术方案：
本发明实施例提供了一种使用大语言模型推理的多回合对话情感四重提取方法，
其包括，采集客服与客户之间的多回合对话数据及上下文信息，并对采集到的数据进行预
处理；
通过动态词元修剪模型对采集的上下文信息进行词元修剪；
建立知识蒸馏模型，根据推理结果结合多回合对话数据构建多层次教师模型；
通过多层级教师模型指导学生模型从多层次的对话知识中学习到对话中的细节
信息；
基于动态词元修剪模型（LazyLLM）和知识蒸馏模型处理后的对话，构建出对话图；
使用二维结构熵最小化算法将对话划分为最小的子对话，并执行合并操作实现最
优划分，形成子对话集；
构建二维表格，标注实体关系，提取话语中的实体，基于子对话集匹配实体，形成
情感四元组；
通过最大池化运算，预测实体之间的关系，并最终匹配情感四元组。
[0007] 作为本发明所述使用大语言模型推理的多回合对话情感四重提取方法的一种优
选方案，其中：所述多回合对话信息，包括客户ID、客服ID、对话内容、时间戳以及对话轮次；
所述上下文信息，包括历史互动记录、对话主题、相关的业务状态和客户信息；
所述预处理，包括数据清洗和文本标准化。
[0008] 作为本发明所述使用大语言模型推理的多回合对话情感四重提取方法的一种优
选方案，其中：所述通过动态词元修剪模型对采集的上下文信息进行词元修剪，包括如下步
骤：
在每个生成步骤中，使用层的注意力图来确定输入词元相对于要
预测的下一个词元的重要性，表示为，
[0009] 其中， 为注意头像的个数， 为序列长度， 为词元在第个头中对词元
的注意力概率， 为词元在第层的置信度分数；
在每一层变换器（transformer）中，根据词元的重要性分数，选择Top‑k百分位作
为词元修剪的阈值，词元在第层的置信度分数小于输入词元中的第百分位，则
该词元将被剪枝，一旦词元被剪枝，将从所有后续层的计算中排除， 表示在第层中用来
确定阈值的百分比；
在每一层中对不同数量的词元进行剪枝；
应用渐进式剪枝策略，在较早的变换器（transformer）层保留更多的词元，在较晚
的层中逐步删除更多词元，并逐渐减少直到变换器（transformer）末尾的词元数量；
在预填充阶段，为每个词元计算隐藏状态，通过移除被剪枝词元的隐藏状态来实
现渐进式词元剪枝；
对于在后续层被剪枝的词元，隐藏状态会被存储在辅助缓存中；
在解码阶段，每个变换器（transformer）层从KV缓存中检索过去词元的KV对，对于
在KV缓存中不存在的词元，动态词元修剪模型（LazyLLM）会从辅助缓存中检索隐藏状态。
[0010] 作为本发明所述使用大语言模型推理的多回合对话情感四重提取方法的一种优
选方案，其中：所述建立知识蒸馏模型，根据推理结果结合多回合对话数据构建多层次教师
模型，包括如下步骤：
构建了不同对话文档组件理解水平的教师；
所有教师的输入由对话数据集中的每轮发言组成，表示为，
[0011] 其中， 代表整个数据集中第i个发言， 是发言的长度， 表示发言中的一个词；
单词级槽填充教师预测每个单词的槽类型，单词级槽填充教师的输出表示
为每个单词的预测槽类型；
句子级意图检测教师预测话语的意图，对的预测用表示，
[0012] 其中， 表示数据集中的意图个数， 为意图检测任务；对话文档级领域分类教师预测对话的领域，从文档级领域分类教师得到
的预测值表示为，
[0013] 其中， 为数据集中域的个数， 为领域分类任务；
应用交叉熵损失，并对预训练模型进行固定轮数的微调，使用最后一个轮次的检
查点作为教师模型，具体表达式为，
[0014] 其中， 和为训练样本数， 为真实值， 表示在训练集中发言
长度为的发言集合， 表示在训练集中发言长度为的集合中的第一个发言，
表示在训练集中发言长度为的集合中的第个发言， 表示在训练集中发言长
度为的集合中的第个发言， 表示交叉熵损失， 表示教师模型，其中
；
所述不同对话文档组件理解水平的教师，包括词级槽位、句子级意图和对话级领
域知识。
[0015] 作为本发明所述使用大语言模型推理的多回合对话情感四重提取方法的一种优
选方案，其中：所述通过多层级教师模型指导学生模型从多层次的对话知识中学习到对话
中的细节信息，包括如下步骤：
通过比较教师模型组合产生的平均概率与学生模型得出的概率来计算KD损失；
使用KD损失来对齐学生模型和教师模型之间的预测概率分布；
通过使用交叉熵损失，学生模型接收到来自真实情况的直接监督信号；
在训练过程中，对每批数据随机生成三元组，通过对教师模型组合的投票进行汇
总，确定三元组的内部关系；
使用三元组损失（TripletMarginLoss）来最小化正样本和锚点样本之间的距离，
同时最大化负样本和锚点样本之间的距离；
通过最大化学生模型和教师模型之间的预测向量（logits）相似度来计算相似度
损失；
将教师模型的预测作为伪标签合并，并为每个班级使用教师模型分配的概率。
[0016] 作为本发明所述使用大语言模型推理的多回合对话情感四重提取方法的一种优
选方案，其中：所述基于动态词元修剪模型（LazyLLM）和知识蒸馏模型处理后的对话，构建
出对话图，包括如下步骤：
在对话数据中，每个回合的发言被视为一个句子，将这些句子组合起来，形成模型
的输入，假设当前的对话数据包含多个回合，每个句子和话语记为，将这些话语串联起来

作为输入，构造输入格式，表示为，
[0017] 其中， 表示串联操作， 是特殊的分类标识符， 是用于区分话语的分隔
符， 表示第n个话语，即序列中最后一个话语；
经过预训练语言模型编码后，得到的输出形式表示为，
[0018] 其中， 是话语的编码符号，令对应
于每个[CLS]作为每个话语的嵌入；
每个话语的嵌入被指定为对话图中的一个节点，根据对话中的回复关系和语义相
似性来构造边；
对于任意两个话语和，如果是对的回复，则在对应的节点和之间建
立一条双向边；
对于任意两个不直接相连的节点和，如果存在一个中间节点使得和通
过形成一条路径，则在和之间增加一条边；
通过节点嵌入的余弦相似度来计算每条边的权重；
每个节点上添加一条自循环边，即在每个节点自身建立一条权重为1的边。
[0019] 作为本发明所述使用大语言模型推理的多回合对话情感四重提取方法的一种优
选方案，其中：所述使用二维结构熵最小化算法将对话划分为最小的子对话，并执行合并操
作实现最优划分，形成子对话集，包括如下步骤：
将对话图初始化为一个编码树，每个叶节点代表对话图中的一个顶点，如果两
个叶节点共享相同的父节点，则表示这两个叶节点属于同一个子对话簇，初始时，每个叶节
点都被视为单独的集群；
对于编码树中的两个子编码树和子编码树共享同一父节点，执行合并操作
生成一个新编码树，在进行合并操作前后，编码树的SE变化计算公
式为，
[0020] 其中， 和分别为子编码树和子编码树在合并后的
， ， 和分别为、和在合并操作前的，若
，表示合并后编码树的减小， 表示合并操作之后的结构熵， 表

附图说明
[0024] 为了更清楚地说明本发明实施例的技术方案，下面将对实施例描述中所需要使用
的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本
领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其它的
附图。
[0025] 图1为实施例1中使用大语言模型推理的多回合对话情感四重提取方法的流程图。
[0026] 图2为实施例1中基于大语言模型的动态词元修剪模型图。
[0027] 图3为实施例1中用于多回合对话理解的知识蒸馏模型图。
[0028] 图4为实施例1中基于结构熵最小化划分的对话方面情感四重提取图。
具体实施方式
[0029] 为使本发明的上述目的、特征和优点能够更加明显易懂，下面结合说明书附图对
本发明的具体实施方式做详细的说明。
[0030] 在下面的描述中阐述了很多具体细节以便于充分理解本发明，但是本发明还可以
采用其他不同于在此描述的其它方式来实施，本领域技术人员可以在不违背本发明内涵的
情况下做类似推广，因此本发明不受下面公开的具体实施例的限制。
[0031] 其次，此处所称的“一个实施例”或“实施例”是指可包含于本发明至少一个实现方
式中的特定特征、结构或特性。在本说明书中不同地方出现的“在一个实施例中”并非均指
同一个实施例，也不是单独的或选择性的与其他实施例互相排斥的实施例。
[0032] 实施例1，参照图1、图2、图3和图4，为本发明第一个实施例，该实施例提供了一种
使用大语言模型推理的多回合对话情感四重提取方法，包括以下步骤：
S1、采集客服与客户之间的多回合对话数据及上下文信息，并对采集到的数据进
行预处理，包括如下步骤：
选择一个功能齐全的在线客服平台，这些平台一般会记录所有客户与客服之间的
对话，在开始采集之前，需确保遵循相关的数据保护法律法规，确保客户的隐私得到保护；
通过平台提供的API或直接数据库访问，提取对话记录，包括客户ID、客服ID、对话
内容、时间戳以及对话轮次；例如，数据结构可能包括如下字段：客户ID：标识客户的唯一编
号，客服ID：标识客服的唯一编号，对话内容：每一轮对话的文本内容，时间戳：记录每条消
息发送的时间，对话轮次：记录对话的轮次信息，以便分析情感变化；
在数据采集的过程中，特别要注意上下文信息的收集，例如，可以记录客户在对话
开始前的历史互动记录，这些历史信息可以提供重要的背景，有助于理解客户的情感变化，
在提取数据时，建议尽量涵盖不同时间段的对话，以捕捉不同的情境和情感表现。上下文信
